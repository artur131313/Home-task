---

# üß† –î–æ–º–∞—à–Ω–µ–µ –∑–∞–¥–∞–Ω–∏–µ  
## üìÅ –°–µ–∫—Ü–∏–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ —Ç–∞–±–ª–∏—Ü—ã –≤ PostgreSQL

### üéØ –¶–µ–ª—å:
- –ù–∞—É—á–∏—Ç—å—Å—è –≤—ã–ø–æ–ª–Ω—è—Ç—å —Å–µ–∫—Ü–∏–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ —Ç–∞–±–ª–∏—Ü –≤ PostgreSQL  
- –ü–æ–≤—ã—Å–∏—Ç—å –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å –∑–∞–ø—Ä–æ—Å–æ–≤ –∏ —É–ø—Ä–æ—Å—Ç–∏—Ç—å —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –¥–∞–Ω–Ω—ã–º–∏

---

## üìå –û–ø–∏—Å–∞–Ω–∏–µ –∑–∞–¥–∞–Ω–∏—è

–ù–∞ –æ—Å–Ω–æ–≤–µ –¥–µ–º–æ–Ω—Å—Ç—Ä–∞—Ü–∏–æ–Ω–Ω–æ–π –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö [PostgreSQL DemoDB](https://postgrespro.ru/education/demodb) —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω–æ —Å–µ–∫—Ü–∏–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ —Ç–∞–±–ª–∏—Ü—ã `bookings`. –î–∞–Ω–Ω—ã–µ –≤ —Ç–∞–±–ª–∏—Ü–µ –æ—Ö–≤–∞—Ç—ã–≤–∞—é—Ç –ø–µ—Ä–∏–æ–¥ —Å `2017-04-21` –ø–æ `2017-08-15`, —á—Ç–æ –¥–µ–ª–∞–µ—Ç –ª–æ–≥–∏—á–Ω—ã–º —Å–µ–∫—Ü–∏–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ –ø–æ –º–µ—Å—è—Ü–∞–º.

---

## üß© –®–∞–≥–∏ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è

### 1. –ê–Ω–∞–ª–∏–∑ —Å—Ç—Ä—É–∫—Ç—É—Ä—ã –¥–∞–Ω–Ω—ã—Ö

**–¢–∞–±–ª–∏—Ü–∞:** `bookings`  
**–°—Ç—Ä—É–∫—Ç—É—Ä–∞:**

```sql
CREATE TABLE bookings.bookings (
	book_ref bpchar(6) NOT NULL,
	book_date timestamptz NOT NULL,
	total_amount numeric(10, 2) NOT NULL,
	CONSTRAINT bookings_pkey PRIMARY KEY (book_ref)
);
```

**–ö–ª—é—á–µ–≤–æ–π —Å—Ç–æ–ª–±–µ—Ü –¥–ª—è —Å–µ–∫—Ü–∏–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏—è:** `book_date`

---

### 2. –í—ã–±–æ—Ä —Ç–∞–±–ª–∏—Ü—ã –∏ –æ–±–æ—Å–Ω–æ–≤–∞–Ω–∏–µ

**–í—ã–±—Ä–∞–Ω–∞ —Ç–∞–±–ª–∏—Ü–∞:** `bookings`  
**–û–±–æ—Å–Ω–æ–≤–∞–Ω–∏–µ:**  
- –°–æ–¥–µ—Ä–∂–∏—Ç –±–æ–ª—å—à–æ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –∑–∞–ø–∏—Å–µ–π, —Å–≤—è–∑–∞–Ω–Ω—ã—Ö —Å –≤—Ä–µ–º–µ–Ω–Ω—ã–º–∏ –ø–µ—Ä–∏–æ–¥–∞–º–∏  
- –ß–∞—Å—Ç–æ –∏—Å–ø–æ–ª—å–∑—É—é—Ç—Å—è –≤—ã–±–æ—Ä–∫–∏ –ø–æ –¥–∞—Ç–µ –±—Ä–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏—è  
- –°–µ–∫—Ü–∏–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ –ø–æ –¥–∞—Ç–∞–º —É–ø—Ä–æ—Å—Ç–∏—Ç —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –¥–∞–Ω–Ω—ã–º–∏ –∏ —É—Å–∫–æ—Ä–∏—Ç –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–µ –∑–∞–ø—Ä–æ—Å–æ–≤

---

### 3. –¢–∏–ø —Å–µ–∫—Ü–∏–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏—è

**–¢–∏–ø:** –°–µ–∫—Ü–∏–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ –ø–æ **–¥–∏–∞–ø–∞–∑–æ–Ω—É** (`RANGE`)  
**–ö–ª—é—á:** `book_date`  
**–û–±–æ—Å–Ω–æ–≤–∞–Ω–∏–µ:** –ü–æ–∑–≤–æ–ª—è–µ—Ç –ª–æ–≥–∏—á–Ω–æ —Ä–∞—Å–ø—Ä–µ–¥–µ–ª–∏—Ç—å –∑–∞–ø–∏—Å–∏ –ø–æ –º–µ—Å—è—Ü–∞–º –±—Ä–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏—è

---

### 4. –°–æ–∑–¥–∞–Ω–∏–µ —Å–µ–∫—Ü–∏–æ–Ω–∏—Ä–æ–≤–∞–Ω–Ω–æ–π —Ç–∞–±–ª–∏—Ü—ã

```sql
CREATE TABLE bookings_partitioned (
    book_ref        char(6)     NOT NULL,
    book_date       timestamp   NOT NULL,
    total_amount    numeric     NOT NULL
) PARTITION BY RANGE (book_date);
```

–°–æ–∑–¥–∞—ë–º –ø–∞—Ä—Ç–∏—Ü–∏–∏ –ø–æ –º–µ—Å—è—Ü–∞–º:

```sql
CREATE TABLE bookings_2017_04 PARTITION OF bookings_partitioned
    FOR VALUES FROM ('2017-04-01') TO ('2017-05-01');

CREATE TABLE bookings_2017_05 PARTITION OF bookings_partitioned
    FOR VALUES FROM ('2017-05-01') TO ('2017-06-01');

CREATE TABLE bookings_2017_06 PARTITION OF bookings_partitioned
    FOR VALUES FROM ('2017-06-01') TO ('2017-07-01');

CREATE TABLE bookings_2017_07 PARTITION OF bookings_partitioned
    FOR VALUES FROM ('2017-07-01') TO ('2017-08-01');

CREATE TABLE bookings_2017_08 PARTITION OF bookings_partitioned
    FOR VALUES FROM ('2017-08-01') TO ('2017-09-01');
```

---

### 5. –ú–∏–≥—Ä–∞—Ü–∏—è –¥–∞–Ω–Ω—ã—Ö

```sql
INSERT INTO bookings_partitioned
SELECT * FROM bookings;
```

–ü—Ä–æ–≤–µ—Ä–∫–∞ —Ä–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏—è –¥–∞–Ω–Ω—ã—Ö:

```sql
SELECT tableoid::regclass AS partition, count(*)
FROM bookings_partitioned
GROUP BY tableoid;
```
–†–µ–∑—É–ª—å—Ç–∞—Ç

![image](https://github.com/user-attachments/assets/c00a259b-b464-4d80-86c8-430af1c7a16e)


---

### 6. –û–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è –∑–∞–ø—Ä–æ—Å–æ–≤

#### –î–æ —Å–µ–∫—Ü–∏–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏—è:

```sql
EXPLAIN ANALYZE
SELECT * FROM bookings
WHERE book_date BETWEEN '2017-06-01' AND '2017-06-30';
```
–†–µ–∑—É–ª—å—Ç–∞—Ç
![image](https://github.com/user-attachments/assets/9f2c9bbc-1af5-4dc5-9f9b-610a1ad8f88d)


#### –ü–æ—Å–ª–µ —Å–µ–∫—Ü–∏–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏—è:

```sql
EXPLAIN ANALYZE
SELECT * FROM bookings_partitioned
WHERE book_date BETWEEN '2017-06-01' AND '2017-06-30';
```

**–†–µ–∑—É–ª—å—Ç–∞—Ç:**  
![image](https://github.com/user-attachments/assets/c4a569bb-bdf6-4b12-9ae8-127b9b35ff89)



–ó–∞–ø—Ä–æ—Å –ø–æ—Å–ª–µ —Å–µ–∫—Ü–∏–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏—è –∏—Å–ø–æ–ª—å–∑—É–µ—Ç —Ç–æ–ª—å–∫–æ –æ–¥–Ω—É –ø–∞—Ä—Ç–∏—Ü–∏—é (`bookings_2017_06`), —á—Ç–æ –∑–Ω–∞—á–∏—Ç–µ–ª—å–Ω–æ —É—Å–∫–æ—Ä—è–µ—Ç –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–µ.

---

### 7. –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –æ–ø–µ—Ä–∞—Ü–∏–π

```sql
-- –í—Å—Ç–∞–≤–∫–∞
INSERT INTO bookings_partitioned VALUES ('ZZ0001', '2017-07-20', 800.00);

-- –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ
UPDATE bookings_partitioned
SET total_amount = 850.00
WHERE book_ref = 'ZZ0001';

-- –£–¥–∞–ª–µ–Ω–∏–µ
DELETE FROM bookings_partitioned
WHERE book_ref = 'ZZ0001';
```

–í—Å–µ –æ–ø–µ—Ä–∞—Ü–∏–∏ —Ä–∞–±–æ—Ç–∞—é—Ç –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ.

---

### 8. –ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–∏ –∏ –≤—ã–≤–æ–¥

```sql
COMMENT ON TABLE bookings_partitioned IS
'–°–µ–∫—Ü–∏–æ–Ω–∏—Ä–æ–≤–∞–Ω–Ω–∞—è —Ç–∞–±–ª–∏—Ü–∞ bookings –ø–æ –¥–∏–∞–ø–∞–∑–æ–Ω—É –¥–∞—Ç –±—Ä–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏—è.';

COMMENT ON TABLE bookings_2017_06 IS
'–ü–∞—Ä—Ç–∏—Ü–∏—è –¥–ª—è –±—Ä–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–π –≤ –∏—é–Ω–µ 2017 –≥–æ–¥–∞.';
```

---

## üìà –í—ã–≤–æ–¥

–°–µ–∫—Ü–∏–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ —Ç–∞–±–ª–∏—Ü—ã `bookings` –ø–æ –¥–∞—Ç–∞–º –±—Ä–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏—è —Å —Ä–∞–∑–±–∏–≤–∫–æ–π –ø–æ –º–µ—Å—è—Ü–∞–º:
- –ü–æ–≤—ã—Å–∏–ª–æ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å –≤—ã–±–æ—Ä–æ–∫;
- –£–ø—Ä–æ—Å—Ç–∏–ª–æ –æ–ø–µ—Ä–∞—Ü–∏–∏ –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞–Ω–∏—è –∏ –∞–Ω–∞–ª–∏–∑–∞;
- –ü–æ–¥–≥–æ—Ç–æ–≤–∏–ª–æ —Å—Ç—Ä—É–∫—Ç—É—Ä—É —Ç–∞–±–ª–∏—Ü—ã –∫ –ø–æ—Ç–µ–Ω—Ü–∏–∞–ª—å–Ω–æ–º—É —Ä–æ—Å—Ç—É –æ–±—ä—ë–º–æ–≤ –¥–∞–Ω–Ω—ã—Ö.

---

## üìé –ü—Ä–∏–ª–æ–∂–µ–Ω–∏–µ ‚Äî SQL-—Å–∫—Ä–∏–ø—Ç

```sql
-- –°–µ–∫—Ü–∏–æ–Ω–∏—Ä–æ–≤–∞–Ω–Ω–∞—è —Ç–∞–±–ª–∏—Ü–∞
CREATE TABLE bookings_partitioned (
    book_ref        char(6)     NOT NULL,
    book_date       timestamp   NOT NULL,
    total_amount    numeric     NOT NULL
) PARTITION BY RANGE (book_date);

-- –ü–∞—Ä—Ç–∏—Ü–∏–∏
CREATE TABLE bookings_2017_04 PARTITION OF bookings_partitioned
    FOR VALUES FROM ('2017-04-01') TO ('2017-05-01');

CREATE TABLE bookings_2017_05 PARTITION OF bookings_partitioned
    FOR VALUES FROM ('2017-05-01') TO ('2017-06-01');

CREATE TABLE bookings_2017_06 PARTITION OF bookings_partitioned
    FOR VALUES FROM ('2017-06-01') TO ('2017-07-01');

CREATE TABLE bookings_2017_07 PARTITION OF bookings_partitioned
    FOR VALUES FROM ('2017-07-01') TO ('2017-08-01');

CREATE TABLE bookings_2017_08 PARTITION OF bookings_partitioned
    FOR VALUES FROM ('2017-08-01') TO ('2017-09-01');

-- –ú–∏–≥—Ä–∞—Ü–∏—è –¥–∞–Ω–Ω—ã—Ö
INSERT INTO bookings_partitioned
SELECT * FROM bookings;

-- –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø–∞—Ä—Ç–∏—Ü–∏–π
SELECT tableoid::regclass AS partition, count(*)
FROM bookings_partitioned
GROUP BY tableoid;
```

---
