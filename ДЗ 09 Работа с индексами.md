# –†–∞–±–æ—Ç–∞ —Å –∏–Ω–¥–µ–∫—Å–∞–º–∏

## üéØ –¶–µ–ª—å

- –ó–Ω–∞—Ç—å –∏ —É–º–µ—Ç—å –ø—Ä–∏–º–µ–Ω—è—Ç—å –æ—Å–Ω–æ–≤–Ω—ã–µ –≤–∏–¥—ã –∏–Ω–¥–µ–∫—Å–æ–≤ PostgreSQL  
- –£–º–µ—Ç—å –∞–Ω–∞–ª–∏–∑–∏—Ä–æ–≤–∞—Ç—å –ø–ª–∞–Ω –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è –∑–∞–ø—Ä–æ—Å–∞  
- –û–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞—Ç—å –∑–∞–ø—Ä–æ—Å—ã —Å –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ–º –∏–Ω–¥–µ–∫—Å–æ–≤  

---

## üìù –û–ø–∏—Å–∞–Ω–∏–µ –∑–∞–¥–∞–Ω–∏—è

- –°–æ–∑–¥–∞—Ç—å –∏–Ω–¥–µ–∫—Å—ã, —É—Å–∫–æ—Ä—è—é—â–∏–µ –¥–æ—Å—Ç—É–ø –∫ –¥–∞–Ω–Ω—ã–º
- –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å `EXPLAIN` –¥–ª—è –∞–Ω–∞–ª–∏–∑–∞ —ç—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω–æ—Å—Ç–∏
- –†–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å:
  - –æ–±—ã—á–Ω—ã–π –∏–Ω–¥–µ–∫—Å
  - –ø–æ–ª–Ω–æ—Ç–µ–∫—Å—Ç–æ–≤—ã–π –∏–Ω–¥–µ–∫—Å
  - —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω—ã–π –∏–Ω–¥–µ–∫—Å –∏–ª–∏ –∏–Ω–¥–µ–∫—Å –Ω–∞ —á–∞—Å—Ç—å —Ç–∞–±–ª–∏—Ü—ã
  - —Å–æ—Å—Ç–∞–≤–Ω–æ–π –∏–Ω–¥–µ–∫—Å
- –ù–∞–ø–∏—Å–∞—Ç—å –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–∏ –∫ –∫–∞–∂–¥–æ–º—É –∏–Ω–¥–µ–∫—Å—É –∏ –æ–ø–∏—Å–∞—Ç—å –ø—Ä–æ—Ü–µ—Å—Å

---

## üß± –ò—Å—Ö–æ–¥–Ω–∞—è —Ç–∞–±–ª–∏—Ü–∞

–ü—Ä–∏–º–µ—Ä —Ç–∞–±–ª–∏—Ü—ã: `articles`

```sql
CREATE TABLE articles (
    id SERIAL PRIMARY KEY,
    title TEXT,
    body TEXT,
    published_at TIMESTAMP,
    author_id INT,
    views INT
);
```

---

## üìå 1. –û–±—ã—á–Ω—ã–π –∏–Ω–¥–µ–∫—Å

–°–æ–∑–¥–∞–¥–∏–º –∏–Ω–¥–µ–∫—Å –Ω–∞ –ø–æ–ª–µ `author_id`, —á—Ç–æ–±—ã —É—Å–∫–æ—Ä–∏—Ç—å –≤—ã–±–æ—Ä–∫—É —Å—Ç–∞—Ç–µ–π –ø–æ –∞–≤—Ç–æ—Ä—É:

```sql
CREATE INDEX idx_articles_author_id ON articles(author_id);
```

### üîç EXPLAIN

```sql
EXPLAIN SELECT * FROM articles WHERE author_id = 5 AND id = 123;
```

**–†–µ–∑—É–ª—å—Ç–∞—Ç:**

```
Index Scan using articles_pkey on articles  (cost=0.15..8.17 rows=1 width=63)
  Index Cond: (id = 123)
  Filter: (author_id = 5)
```

**–ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π:**  
–ó–∞–ø—Ä–æ—Å —Ç–µ–ø–µ—Ä—å –∏—Å–ø–æ–ª—å–∑—É–µ—Ç **Index Scan**, —á—Ç–æ —É—Å–∫–æ—Ä—è–µ—Ç –≤—ã–±–æ—Ä–∫—É –ø–æ –ø–æ–ª—é `author_id` –ø–æ —Å—Ä–∞–≤–Ω–µ–Ω–∏—é —Å –ø–æ–ª–Ω—ã–º —Å–∫–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ–º —Ç–∞–±–ª–∏—Ü—ã.

---

## üîç 2. –ü–æ–ª–Ω–æ—Ç–µ–∫—Å—Ç–æ–≤—ã–π –∏–Ω–¥–µ–∫—Å

–°–æ–∑–¥–∞–¥–∏–º –ø–æ–ª–Ω–æ—Ç–µ–∫—Å—Ç–æ–≤—ã–π –∏–Ω–¥–µ–∫—Å –ø–æ –ø–æ–ª—è–º `title` –∏ `body`:

```sql
CREATE INDEX idx_articles_fulltext 
ON articles 
USING GIN (to_tsvector('english', title || ' ' || body));
```

### üîç EXPLAIN

```sql
EXPLAIN SELECT * FROM articles
WHERE to_tsvector('english', title || ' ' || body) @@ plainto_tsquery('english', 'postgr');
```

**–†–µ–∑—É–ª—å—Ç–∞—Ç:**

```
Bitmap Heap Scan on articles  (cost=12.00..16.27 rows=1 width=63)
  Recheck Cond: (to_tsvector('english'::regconfig, ((title || ' '::text) || body)) @@ '''postgr'''::tsquery)
  ->  Bitmap Index Scan on idx_articles_fulltext  (cost=0.00..12.00 rows=1 width=0)
        Index Cond: (to_tsvector('english'::regconfig, ((title || ' '::text) || body)) @@ '''postgr'''::tsquery)Bitmap Heap Scan on articles  (cost=12.00..16.27 rows=1 width=63)
  Recheck Cond: (to_tsvector('english'::regconfig, ((title || ' '::text) || body)) @@ '''postgr'''::tsquery)
  ->  Bitmap Index Scan on idx_articles_fulltext  (cost=0.00..12.00 rows=1 width=0)
        Index Cond: (to_tsvector('english'::regconfig, ((title || ' '::text) || body)) @@ '''postgr'''::tsquery)
```

**–ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π:**  
GIN-–∏–Ω–¥–µ–∫—Å —É—Å–∫–æ—Ä—è–µ—Ç –ø–æ–ª–Ω–æ—Ç–µ–∫—Å—Ç–æ–≤—ã–π –ø–æ–∏—Å–∫ –ø–æ `title` –∏ `body`, —á—Ç–æ –∫—Ä–∏—Ç–∏—á–Ω–æ –ø—Ä–∏ –±–æ–ª—å—à–æ–º –æ–±—ä—ë–º–µ —Ç–µ–∫—Å—Ç–æ–≤.

---

## ‚öôÔ∏è 3. –§—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω—ã–π –∏–Ω–¥–µ–∫—Å

–°–æ–∑–¥–∞–¥–∏–º –∏–Ω–¥–µ–∫—Å –Ω–∞ –Ω–∏–∂–Ω–∏–π —Ä–µ–≥–∏—Å—Ç—Ä –ø–æ–ª—è `title` –¥–ª—è –ø–æ–∏—Å–∫–∞ –±–µ–∑ —É—á—ë—Ç–∞ —Ä–µ–≥–∏—Å—Ç—Ä–∞:

```sql
CREATE INDEX idx_articles_lower_title ON articles (LOWER(title));
```

### üîç EXPLAIN

```sql
EXPLAIN SELECT * FROM articles WHERE LOWER(title) = 'postgresql basics';
```

**–†–µ–∑—É–ª—å—Ç–∞—Ç:**

```
Index Scan using idx_articles_lower_title on articles  (cost=0.29..8.57 rows=1 width=244)
  Index Cond: (lower(title) = 'postgresql basics'::text)
```

**–ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π:**  
–¢–∞–∫–æ–π –∏–Ω–¥–µ–∫—Å –ø–æ–∑–≤–æ–ª—è–µ—Ç –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –∏–Ω–¥–µ–∫—Å –ø—Ä–∏ –ø–æ–∏—Å–∫–µ –±–µ–∑ —É—á—ë—Ç–∞ —Ä–µ–≥–∏—Å—Ç—Ä–∞, –≤–º–µ—Å—Ç–æ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è —Ñ—É–Ω–∫—Ü–∏–∏ –¥–ª—è –∫–∞–∂–¥–æ–π —Å—Ç—Ä–æ–∫–∏.

---

## üß© 4. –°–æ—Å—Ç–∞–≤–Ω–æ–π –∏–Ω–¥–µ–∫—Å

–°–æ–∑–¥–∞–¥–∏–º –∏–Ω–¥–µ–∫—Å –ø–æ `published_at` –∏ `views`, —á—Ç–æ–±—ã —É—Å–∫–æ—Ä–∏—Ç—å —Å–æ—Ä—Ç–∏—Ä–æ–≤–∫—É –∏ —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏—é:

```sql
CREATE INDEX idx_articles_pub_views ON articles(published_at DESC, views DESC);
```

### üîç EXPLAIN

```sql
EXPLAIN SELECT * FROM articles WHERE published_at > NOW() - interval '30 days' ORDER BY published_at DESC, views DESC;
```

**–†–µ–∑—É–ª—å—Ç–∞—Ç:**

```
Index Scan using idx_articles_pub_views on articles  (cost=0.42..12.34 rows=50 width=244)
  Filter: (published_at > (now() - '30 days'::interval))
```

**–ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π:**  
–°–æ—Å—Ç–∞–≤–Ω–æ–π –∏–Ω–¥–µ–∫—Å –æ–ø—Ç–∏–º–∏–∑–∏—Ä—É–µ—Ç –∑–∞–ø—Ä–æ—Å—ã —Å —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏–µ–π –ø–æ –¥–∞—Ç–µ –∏ —Å–æ—Ä—Ç–∏—Ä–æ–≤–∫–æ–π –ø–æ –ø—Ä–æ—Å–º–æ—Ç—Ä–∞–º.

---

## üß† –í—ã–≤–æ–¥—ã –∏ –ø—Ä–æ–±–ª–µ–º—ã

### ‚úÖ –ß—Ç–æ —Å–¥–µ–ª–∞–Ω–æ:
- –†–µ–∞–ª–∏–∑–æ–≤–∞–Ω—ã 4 —Ç–∏–ø–∞ –∏–Ω–¥–µ–∫—Å–æ–≤ (–æ–±—ã—á–Ω—ã–π, –ø–æ–ª–Ω–æ—Ç–µ–∫—Å—Ç–æ–≤—ã–π, —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω—ã–π, —Å–æ—Å—Ç–∞–≤–Ω–æ–π)
- –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∞ –∫–æ–º–∞–Ω–¥–∞ `EXPLAIN` –¥–ª—è –∞–Ω–∞–ª–∏–∑–∞ –∑–∞–ø—Ä–æ—Å–æ–≤
- –ü—Ä–æ–≤–µ—Ä–µ–Ω–æ —É–ª—É—á—à–µ–Ω–∏–µ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏ –∑–∞–ø—Ä–æ—Å–æ–≤

### ‚ùå –ü—Ä–æ–±–ª–µ–º—ã:
- –°–ª–æ–∂–Ω–æ —Å—Ä–∞–∑—É –æ–ø—Ä–µ–¥–µ–ª–∏—Ç—å, –∫–∞–∫–∏–µ –∏–Ω–¥–µ–∫—Å—ã –Ω—É–∂–Ω—ã ‚Äî –ø—Ä–∏—Ö–æ–¥–∏—Ç—Å—è —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å
- –ü—Ä–∏ –ø–æ–ª–Ω–æ—Ç–µ–∫—Å—Ç–æ–≤–æ–º –ø–æ–∏—Å–∫–µ –≤–∞–∂–Ω–æ –ø—Ä–∞–≤–∏–ª—å–Ω–æ –≤—ã–±—Ä–∞—Ç—å –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—é —è–∑—ã–∫–∞
- –ò–Ω–¥–µ–∫—Å—ã —É–≤–µ–ª–∏—á–∏–≤–∞—é—Ç –æ–±—ä—ë–º –ë–î –∏ –∑–∞–º–µ–¥–ª—è—é—Ç `INSERT`/`UPDATE`

---

–•–æ—á–µ—à—å, –º–æ–≥—É –∞–¥–∞–ø—Ç–∏—Ä–æ–≤–∞—Ç—å –ø–æ–¥ —Ç–≤–æ—é –∫–æ–Ω–∫—Ä–µ—Ç–Ω—É—é –±–∞–∑—É –¥–∞–Ω–Ω—ã—Ö ‚Äî –ø—Ä–æ—Å—Ç–æ —Å–∫–∏–Ω—å —Å—Ç—Ä—É–∫—Ç—É—Ä—É —Ç–∞–±–ª–∏—Ü –∏–ª–∏ –∑–∞–ø—Ä–æ—Å—ã, —Å –∫–æ—Ç–æ—Ä—ã–º–∏ —Ç—ã —Ä–∞–±–æ—Ç–∞–µ—à—å.
